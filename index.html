<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiller vs Gold - Historical Market Valuation</title>
    <meta name="description" content="Interactive visualization of CAPE ratio, home prices, S&P 500, and gold prices. Explore historical market valuations around major economic events from 1871 to present.">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" href="preview.png">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Shiller vs Gold - Historical Market Valuation">
    <meta property="og:description" content="Interactive visualization of CAPE ratio, home prices, S&P 500, and gold prices. Explore historical market valuations around major economic events.">
    <meta property="og:image" content="https://posix4e.github.io/shillervsgold/preview.png">
    <meta property="og:url" content="https://posix4e.github.io/shillervsgold/">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Shiller vs Gold - Historical Market Valuation">
    <meta name="twitter:description" content="Interactive visualization of CAPE ratio, home prices, S&P 500, and gold prices since 1871.">
    <meta name="twitter:image" content="https://posix4e.github.io/shillervsgold/preview.png">

    <!-- Stylesheets and Scripts -->
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Shiller vs Gold</h1>
            <p class="subtitle">Historical Market Valuations: CAPE Ratio, Home Prices, and Gold</p>
            <button id="settingsButton" class="settings-button" title="Settings">‚öôÔ∏è</button>
        </header>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>‚öôÔ∏è Settings</h2>

                <div class="settings-section">
                    <h3>üîç Polygon.io API Key</h3>
                    <p class="help-text">Enter your free <a href="https://polygon.io/dashboard/signup" target="_blank">Polygon.io API key</a> to search custom tickers (AAPL, TSLA, BTC-USD, etc.)</p>

                    <div class="api-input-container">
                        <input type="text" id="apiKeyInput" placeholder="Paste your Polygon.io API key here..." class="api-key-input">
                        <button id="saveApiKey" class="primary-button">üíæ Save</button>
                        <button id="clearApiKey" class="secondary-button">üóëÔ∏è Clear</button>
                    </div>

                    <p class="help-text" style="margin-top: 10px; font-size: 0.9em;">
                        Your API key is stored locally in your browser only. Free tier: 5 calls/minute, <strong>2 years of data only</strong>.<br>
                        The 2-year limit is a Polygon.io free account restriction. We haven't implemented paid tier support, but if you sponsor this project, we'll add it!
                    </p>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="dateRange">Date Range:</label>
                <select id="dateRange">
                    <option value="british">British History (1250+) - Gold only</option>
                    <option value="modern" selected>Modern History (1871+) - CAPE, Stocks, Homes</option>
                    <option value="100">Last 100 Years</option>
                    <option value="50">Last 50 Years</option>
                    <option value="2">Last 2 Years - Custom tickers (Polygon free tier)</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>

            <div id="customRange" class="custom-range" style="display: none;">
                <input type="number" id="startYear" placeholder="Start Year" min="1250">
                <input type="number" id="endYear" placeholder="End Year" max="2025">
                <button id="applyRange">Apply</button>
            </div>

            <div class="date-range-info">
                <p class="help-text">
                    <strong>Note:</strong> Different data sources have different date ranges available.
                    Custom tickers from Polygon.io (free tier) are limited to 2 years of historical data.
                </p>
            </div>
        </div>

        <div class="chart-config-section">
            <h2>Chart & Calculator Configuration</h2>

            <div class="compare-mode-toggle">
                <label>
                    <input type="checkbox" id="compareMode">
                    <span>Compare Multiple Assets</span>
                </label>
            </div>

            <div id="singleAssetConfig" class="asset-config">
                <h3>Display Settings</h3>
                <div class="config-row">
                    <div class="control-group asset-search-group">
                        <label>Asset:</label>
                        <div class="asset-search-container">
                            <input type="text" id="asset1" class="asset-search" placeholder="Search: home, gold, spy, btc-usd..." data-asset="home" value="Home Price Index">
                            <div class="asset-suggestions" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="control-group asset-search-group">
                        <label>Valued in:</label>
                        <div class="asset-search-container">
                            <input type="text" id="denominator1" class="asset-search" placeholder="Search: gold, real, nominal..." data-asset="gold" value="Gold">
                            <div class="asset-suggestions" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="investmentAmount">Investment ($, optional):</label>
                        <input type="number" id="investmentAmount" placeholder="Optional" min="0" step="100">
                    </div>

                </div>
            </div>

            <div id="compareConfig" class="asset-config" style="display: none;">
                <h3>Compare Multiple Assets</h3>

                <div class="compare-denominator-section">
                    <div class="control-group">
                        <label for="compareDenominator">All assets valued in:</label>
                        <select id="compareDenominator">
                            <option value="real">Real USD (Inflation-Adjusted)</option>
                            <option value="nominal">Nominal USD</option>
                            <option value="gold" selected>Gold</option>
                            <option value="btc">Bitcoin</option>
                            <option value="home">Home Price</option>
                            <option value="sp500">S&P 500</option>
                        </select>
                    </div>
                </div>

                <div id="compareAssets">
                    <div class="compare-row" data-index="0">
                        <div class="control-group asset-search-group">
                            <label>Asset 1:</label>
                            <div class="asset-search-container">
                                <input type="text" class="asset-search" placeholder="Search: home, gold, spy, btc-usd..." data-asset="home" value="Home Price Index">
                                <div class="asset-suggestions" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="compare-row" data-index="1">
                        <div class="control-group asset-search-group">
                            <label>Asset 2:</label>
                            <div class="asset-search-container">
                                <input type="text" class="asset-search" placeholder="Search: home, gold, spy, btc-usd..." data-asset="sp500" value="S&P 500">
                                <div class="asset-suggestions" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="compare-controls">
                    <button id="addComparison" class="add-button">+ Add Asset</button>
                </div>
            </div>

            <div id="calculatorResults" class="calculator-results" style="display: none;">
                <div class="result-card">
                    <h3>Period</h3>
                    <p id="periodDates" style="font-size: 1.2em; white-space: pre-line;">-</p>
                </div>
                <div class="result-card">
                    <h3>Initial Investment</h3>
                    <p id="initialAmount">$0</p>
                </div>
                <div class="result-card">
                    <h3>Final Value</h3>
                    <p id="finalValue">$0</p>
                </div>
                <div class="result-card">
                    <h3>Total Return</h3>
                    <p id="totalReturn">$0</p>
                </div>
                <div class="result-card">
                    <h3>Return Percentage</h3>
                    <p id="returnPercentage">0%</p>
                </div>
                <div class="result-card">
                    <h3>Annualized Return</h3>
                    <p id="annualizedReturn">0%</p>
                </div>
            </div>
        </div>

        <div class="single-chart-container">
            <div class="chart-container">
                <canvas id="main-chart"></canvas>
            </div>
        </div>

        <div class="stats-panel">
            <div class="stat-card">
                <h3>Current CAPE Ratio</h3>
                <p id="currentCAPE">Loading...</p>
            </div>
            <div class="stat-card">
                <h3>Current Gold Price</h3>
                <p id="currentGold">Loading...</p>
            </div>
            <div class="stat-card">
                <h3>CAPE/Gold Ratio</h3>
                <p id="currentRatio">Loading...</p>
            </div>
            <div class="stat-card">
                <h3>Historical Percentile</h3>
                <p id="percentile">Loading...</p>
            </div>
        </div>

        <div class="info-section">
            <h2>About This Chart</h2>
            <p>
                This visualization combines Robert Shiller's CAPE (Cyclically Adjusted Price-to-Earnings) ratio
                and home price data with historical gold prices to show relative valuations over time.
                The CAPE ratio helps identify periods of stock market overvaluation or undervaluation,
                while comparing it to gold provides additional context about real value.
            </p>

            <h3>üìä Data Sources & Availability</h3>

            <div class="data-source-details">
                <div class="data-source-card">
                    <h4>üèõÔ∏è Shiller CAPE Ratio</h4>
                    <ul>
                        <li><strong>Date Range:</strong> 1871 - Present</li>
                        <li><strong>Update Frequency:</strong> Monthly</li>
                        <li><strong>Source:</strong> <a href="https://posix4e.github.io/shiller_wrapper_data/" target="_blank">Shiller Wrapper Data</a></li>
                        <li><strong>Coverage:</strong> US Stock Market (S&P 500 and predecessors)</li>
                    </ul>
                </div>

                <div class="data-source-card">
                    <h4>üè† Home Price Index</h4>
                    <ul>
                        <li><strong>Date Range:</strong> 1890 - Present</li>
                        <li><strong>Update Frequency:</strong> Quarterly</li>
                        <li><strong>Source:</strong> <a href="https://posix4e.github.io/shiller_wrapper_data/" target="_blank">Shiller Wrapper Data</a></li>
                        <li><strong>Coverage:</strong> US National Average Home Prices</li>
                    </ul>
                </div>

                <div class="data-source-card">
                    <h4>üìà S&P 500 Index</h4>
                    <ul>
                        <li><strong>Date Range:</strong> 1871 - Present</li>
                        <li><strong>Update Frequency:</strong> Monthly</li>
                        <li><strong>Source:</strong> <a href="https://posix4e.github.io/shiller_wrapper_data/" target="_blank">Shiller Wrapper Data</a></li>
                        <li><strong>Coverage:</strong> US Stock Market (nominal and real prices)</li>
                    </ul>
                </div>

                <div class="data-source-card">
                    <h4>ü•á Gold Prices</h4>
                    <ul>
                        <li><strong>Date Range:</strong> 1258 - Present</li>
                        <li><strong>Update Frequency:</strong> Daily (updated 6 AM UTC)</li>
                        <li><strong>Source:</strong> <a href="https://freegoldapi.com/" target="_blank">FreeGoldAPI</a></li>
                        <li><strong>Coverage:</strong> Historical gold prices in USD (includes medieval British data)</li>
                    </ul>
                </div>

                <div class="data-source-card">
                    <h4>‚Çø Bitcoin Price</h4>
                    <ul>
                        <li><strong>Date Range:</strong> 2013 - Present</li>
                        <li><strong>Update Frequency:</strong> Daily</li>
                        <li><strong>Source:</strong> <a href="https://dailysatprice.com/" target="_blank">DailySatPrice</a></li>
                        <li><strong>Coverage:</strong> Bitcoin spot price in USD</li>
                    </ul>
                </div>

                <div class="data-source-card">
                    <h4>üìä Custom Tickers (Stocks, Crypto, ETFs)</h4>
                    <ul>
                        <li><strong>Date Range:</strong> <span style="color: #e74c3c; font-weight: bold;">Last 2 Years Only (Free Tier Limitation)</span></li>
                        <li><strong>Update Frequency:</strong> Daily</li>
                        <li><strong>Source:</strong> <a href="https://polygon.io/" target="_blank">Polygon.io API</a></li>
                        <li><strong>Rate Limit:</strong> 5 API calls per minute (free tier)</li>
                        <li><strong>Requirements:</strong> Free API key (setup via ‚öôÔ∏è Settings button)</li>
                        <li><strong>Coverage:</strong> Any US stock ticker, crypto pairs (BTC-USD), and ETFs</li>
                        <li><strong>Why 2 years?</strong> This is a Polygon.io free tier restriction. Users provide their own free API keys, so we haven't implemented paid tier support. However, if you <a href="https://github.com/posix4e/shillervsgold" target="_blank">sponsor the project</a>, we'll add paid account integration for full historical data!</li>
                    </ul>
                </div>
            </div>

            <h3>üí° Tips for Using Custom Tickers</h3>
            <ul class="tips-list">
                <li>üîπ Custom tickers (AAPL, TSLA, etc.) are limited to 2 years of history - this is a Polygon.io free account restriction</li>
                <li>üîπ We haven't implemented paid Polygon tier support yet, but <strong>sponsor us on GitHub and we'll add it!</strong></li>
                <li>üîπ Use the "Last 2 Years" date range option when viewing custom tickers</li>
                <li>üîπ Built-in assets (CAPE, S&P 500, Gold, Bitcoin, Homes) have full historical data available</li>
                <li>üîπ You can compare custom tickers against built-in assets within their available date ranges</li>
                <li>üîπ Your API key is stored locally in your browser and never sent to our servers</li>
            </ul>
        </div>

        <footer>
            <p>Created with data from Robert Shiller's research and FreeGoldAPI</p>
            <p><a href="https://github.com/posix4e/shillervsgold" target="_blank" style="color: white; text-decoration: none;">‚≠ê View on GitHub</a> | <a href="https://github.com/posix4e/btc-mnav-rainbow" target="_blank" style="color: white; text-decoration: none;">üåà See also: BTC Rainbow Chart</a></p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
